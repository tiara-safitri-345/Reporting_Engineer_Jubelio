--1.Buat tabel promo_code
CREATE TABLE promo_code(
    promo_id int primary key
	promo_name varchar,
	price_deduction int,
	description varchar
	duration int
);

2.Buat tabel q3_q4_review
CREATE TABLE Q3_Q4_Review(
	purchase_date DATE,
    total_price int,
    promo_name varchar,
    sales_after_promo int,
	status_promo text
);

3.Mengisi tabel q3_q4_review
INSERT INTO q3_q4_review
    (purchase_date, total_price, promo_name, sales_after_promo, status_promo)
SELECT
    s.purchase_date,
    s.quantity * m.price AS total_price,
    p.promo_name,
    (s.quantity * m.price) - COALESCE(p.price_deduction, 0) AS sales_after_promo,
    CASE
        WHEN p.promo_name IS NOT NULL THEN 'Dengan Promo'
        ELSE 'Tanpa Promo'
    END AS status_promo
FROM sales_table s
LEFT JOIN marketplace_table m ON s.item_id = m.item_id
LEFT JOIN promo_code p        ON s.promo_id = p.promo_id
WHERE s.purchase_date BETWEEN '2022-07-01' AND '2022-12-31'
ORDER BY s.purchase_date;

4.Buat tabel shipping_summary
CREATE TABLE shipping_summary(
    shipping_date date,
	seller_name varchar(255),
	buyer_name varchar(255),
	buyer_address varchar(255),
	buyer_city varchar(255),
	buyer_zipcode int,
	kode_resi varchar(255)
);


5.Mengisi tabel shipping_summary
INSERT INTO shipping_summary
    (shipping_date, seller_name, buyer_name,
     buyer_address, buyer_city, buyer_zipcode, kode_resi)
SELECT
    sh.shipping_date,
    se.seller_name,
    b.buyer_name,
    b.address        AS buyer_address,
    b.city           AS buyer_city,
    b.zipcode        AS buyer_zipcode,
    CONCAT(
        sh.shipping_id, '-',
        TO_CHAR(sh.shipping_date,'YYYYMMDD'), '-',
        b.buyer_id, '-',
        se.seller_id
    ) AS kode_resi
FROM shipping_table sh
JOIN seller_table se ON sh.seller_id = se.seller_id
JOIN buyer_table  b  ON sh.buyer_id  = b.buyer_id;
